= 事件
:page-toclevels: 1

`Neutralino.events` 命名空间包含与原生事件处理相关的方法。这些事件通常是由 Neutralinojs 服务器基于原生状态变化发起的。

[[event-types]]
== 事件类型

|===
|事件 id| 描述| 可用模式| 额外数据
|`ready`| 当客户端库与 Neutralino 服务器连接时发生| `all`| `null`
|`trayMenuItemClicked`| 当用户点击托盘菜单项时发生| `all`| `TrayMenuItem`
|`windowClose`| 当用户关闭窗口时发生| `window`| `null`
|`windowFocus`| 当窗口获得焦点时发生| `window`| `null`
|`windowBlur`| 当窗口焦点状态消失时发生| `window`| `null`
|`serverOffline`| 当 Neutralino 服务器离线时发生| `all`| `null`
|`clientConnect`| 当新客户端访问应用程序时发生| `all`| 总客户端数
|`clientDisconnect`| 当已连接的客户端离开应用程序时发生| `all`| 总客户端数
|`appClientConnect`| 当新应用程序实例启动时发生| `all`| 总应用程序客户端数
|`appClientDisconnect`| 当应用程序实例结束时发生| `all`| 总应用程序客户端数
|`extClientConnect`| 当新扩展连接时发生| `all`| 扩展标识符
|`extClientDisconnect`| 当扩展断开连接时发生| `all`| 扩展标识符
|`extensionReady`| 当扩展准备好与应用程序通信时发生| `all`| 扩展标识符
|`spawnedProcess`| 当派生进程更新时发生| `all`| `SpawnedProcess`，包含``action``（`stdOut`、`stdErr` 和 `exit`）和``data``（STDOUT、STDERR 或退出代码）
|`openedFile`| 对于每次读取操作以及每当流光标到达 EOF 时发生| `all`| 文件流标识符，包含``action``（`data`、`dataBinary` 和 `end`）和``data``（流块内容）
|`watchFile`| 基于监视器的每次文件系统更改事件发生| `all`| 文件监视器标识符，包含``action``（`add`、`delete`、`modified` 和 `moved`）、``dir``和``filename``
|===

[[eventsoneventname-handler]]
== 注册事件

`events.on(eventName, handler)`

注册一个新的事件处理器。

[[parameters]]
=== 参数

* `eventName` String：事件的名称。
* `handler` Function：当给定事件发生时将被调用的函数。Neutralinojs 会通过附加额外数据到 `detail` key来调用处理器，传递一个 `link:https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent[CustomEvent]` 实例。

[source,javascript]
----
function onTrayMenuItemClicked(event) {
  console.log(`Event data: ${event.detail}`);
}
await Neutralino.events.on('trayMenuItemClicked', onTrayMenuItemClicked);
----

[[eventsoffeventname-handler]]
== 注销事件

`events.off(eventName, handler)`

注销一个事件处理器。

[[parameters-1]]
=== 参数

* `eventName` String：事件的名称。
* `handler` Function：函数引用。

[source,javascript]
----
await Neutralino.events.off('trayMenuItemClicked', onTrayMenuItemClicked);
----

[[eventsdispatcheventname-data]]
== 分发事件

`events.dispatch(eventName, data)`

向当前应用程序实例分发一个新的事件。Neutralinojs 客户端内部使用这个 JavaScript 函数调用来分发原生事件。

[[parameters-2]]
=== 参数

* `eventName` String：事件的名称。
* `data` Object（可选）：事件的额外数据。

[source,javascript]
----
await Neutralino.events.dispatch('myTestEvent', {myData: 'Test data'});
----

[[eventsbroadcasteventname-data]]
== 广播事件

`events.broadcast(eventName, data)`

向所有客户端（包括应用程序客户端和扩展客户端）分发一个新的事件。

[[parameters-3]]
=== 参数

* `eventName` String：事件的名称。
* `data` Object（可选）：事件的额外数据。

[source,javascript]
----
await Neutralino.events.broadcast('myTestEvent', 'Hello');

await Neutralino.events.broadcast('myTestEvent', {myData: 'Test data'});

await Neutralino.events.broadcast('myTestEvent'); // without any data payload
----
